{"ast":null,"code":"import _objectSpread from\"C:/Users/SR/OneDrive/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useEffect,useState}from\"react\";import{useAuth}from\"./AuthContext\";import axios from\"axios\";import{API_BASE_URL,ENDPOINTS}from\"../constants/config\";import{jsx as _jsx}from\"react/jsx-runtime\";const CartContext=/*#__PURE__*/createContext(null);export const CartProvider=_ref=>{let{children}=_ref;const{user,token}=useAuth();const[items,setItems]=useState(()=>{try{const raw=localStorage.getItem(\"cart_items\");return raw?JSON.parse(raw):[];}catch(e){return[];}});const[loading,setLoading]=useState(false);// Sync cart with backend when user logs in\nuseEffect(()=>{if(user&&token){fetchCartFromBackend();}},[user,token]);// Save cart to localStorage whenever it changes\nuseEffect(()=>{try{localStorage.setItem(\"cart_items\",JSON.stringify(items));}catch(e){}},[items]);const fetchCartFromBackend=async()=>{try{setLoading(true);const response=await axios.get(\"\".concat(API_BASE_URL).concat(ENDPOINTS.CART),{headers:{Authorization:\"Bearer \".concat(token)}});const cartItems=response.data.items.map(item=>({id:item.product_id,name:item.name,price:item.price,image:item.image,description:item.description,quantity:item.quantity}));setItems(cartItems);}catch(err){console.error(\"Error fetching cart from backend:\",err);}finally{setLoading(false);}};const addToCart=async function(product){let quantity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;setItems(prev=>{const existing=prev.find(i=>i.id===product.id);if(existing){return prev.map(i=>i.id===product.id?_objectSpread(_objectSpread({},i),{},{quantity:i.quantity+quantity}):i);}return[...prev,_objectSpread(_objectSpread({},product),{},{quantity})];});// Sync with backend if user is logged in\nif(user&&token){try{await axios.post(\"\".concat(API_BASE_URL).concat(ENDPOINTS.CART),{product_id:product.id,quantity,price:product.price},{headers:{Authorization:\"Bearer \".concat(token)}});}catch(err){console.error(\"Error adding item to backend cart:\",err);}}};const removeFromCart=async productId=>{setItems(prev=>prev.filter(i=>i.id!==productId));// Sync with backend if user is logged in\nif(user&&token){try{await axios.delete(\"\".concat(API_BASE_URL).concat(ENDPOINTS.CART,\"/\").concat(productId),{headers:{Authorization:\"Bearer \".concat(token)}});}catch(err){console.error(\"Error removing item from backend cart:\",err);}}};const updateQuantity=async(productId,quantity)=>{setItems(prev=>prev.map(i=>i.id===productId?_objectSpread(_objectSpread({},i),{},{quantity}):i));// Sync with backend if user is logged in\nif(user&&token){try{await axios.put(\"\".concat(API_BASE_URL).concat(ENDPOINTS.CART,\"/\").concat(productId),{quantity},{headers:{Authorization:\"Bearer \".concat(token)}});}catch(err){console.error(\"Error updating cart quantity in backend:\",err);}}};const clearCart=async()=>{setItems([]);// Sync with backend if user is logged in\nif(user&&token){try{await axios.delete(\"\".concat(API_BASE_URL).concat(ENDPOINTS.CART),{headers:{Authorization:\"Bearer \".concat(token)}});}catch(err){console.error(\"Error clearing backend cart:\",err);}}};const getTotalPrice=()=>{return items.reduce((sum,i)=>sum+Number(i.price||0)*Number(i.quantity||1),0);};const getTotalItems=()=>items.reduce((sum,i)=>sum+Number(i.quantity||0),0);return/*#__PURE__*/_jsx(CartContext.Provider,{value:{items,addToCart,removeFromCart,updateQuantity,clearCart,getTotalPrice,getTotalItems,loading},children:children});};export const useCart=()=>{const ctx=useContext(CartContext);if(!ctx)throw new Error(\"useCart must be used within CartProvider\");return ctx;};export default CartContext;","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useAuth","axios","API_BASE_URL","ENDPOINTS","jsx","_jsx","CartContext","CartProvider","_ref","children","user","token","items","setItems","raw","localStorage","getItem","JSON","parse","e","loading","setLoading","fetchCartFromBackend","setItem","stringify","response","get","concat","CART","headers","Authorization","cartItems","data","map","item","id","product_id","name","price","image","description","quantity","err","console","error","addToCart","product","arguments","length","undefined","prev","existing","find","i","_objectSpread","post","removeFromCart","productId","filter","delete","updateQuantity","put","clearCart","getTotalPrice","reduce","sum","Number","getTotalItems","Provider","value","useCart","ctx","Error"],"sources":["C:/Users/SR/OneDrive/Desktop/frontend/src/context/CartContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { useAuth } from \"./AuthContext\";\r\nimport axios from \"axios\";\r\nimport { API_BASE_URL, ENDPOINTS } from \"../constants/config\";\r\n\r\nconst CartContext = createContext(null);\r\n\r\nexport const CartProvider = ({ children }) => {\r\n  const { user, token } = useAuth();\r\n  const [items, setItems] = useState(() => {\r\n    try {\r\n      const raw = localStorage.getItem(\"cart_items\");\r\n      return raw ? JSON.parse(raw) : [];\r\n    } catch (e) {\r\n      return [];\r\n    }\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Sync cart with backend when user logs in\r\n  useEffect(() => {\r\n    if (user && token) {\r\n      fetchCartFromBackend();\r\n    }\r\n  }, [user, token]);\r\n\r\n  // Save cart to localStorage whenever it changes\r\n  useEffect(() => {\r\n    try {\r\n      localStorage.setItem(\"cart_items\", JSON.stringify(items));\r\n    } catch (e) {}\r\n  }, [items]);\r\n\r\n  const fetchCartFromBackend = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await axios.get(`${API_BASE_URL}${ENDPOINTS.CART}`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      const cartItems = response.data.items.map((item) => ({\r\n        id: item.product_id,\r\n        name: item.name,\r\n        price: item.price,\r\n        image: item.image,\r\n        description: item.description,\r\n        quantity: item.quantity,\r\n      }));\r\n      setItems(cartItems);\r\n    } catch (err) {\r\n      console.error(\"Error fetching cart from backend:\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const addToCart = async (product, quantity = 1) => {\r\n    setItems((prev) => {\r\n      const existing = prev.find((i) => i.id === product.id);\r\n      if (existing) {\r\n        return prev.map((i) =>\r\n          i.id === product.id ? { ...i, quantity: i.quantity + quantity } : i\r\n        );\r\n      }\r\n      return [...prev, { ...product, quantity }];\r\n    });\r\n\r\n    // Sync with backend if user is logged in\r\n    if (user && token) {\r\n      try {\r\n        await axios.post(\r\n          `${API_BASE_URL}${ENDPOINTS.CART}`,\r\n          {\r\n            product_id: product.id,\r\n            quantity,\r\n            price: product.price,\r\n          },\r\n          { headers: { Authorization: `Bearer ${token}` } }\r\n        );\r\n      } catch (err) {\r\n        console.error(\"Error adding item to backend cart:\", err);\r\n      }\r\n    }\r\n  };\r\n\r\n  const removeFromCart = async (productId) => {\r\n    setItems((prev) => prev.filter((i) => i.id !== productId));\r\n\r\n    // Sync with backend if user is logged in\r\n    if (user && token) {\r\n      try {\r\n        await axios.delete(`${API_BASE_URL}${ENDPOINTS.CART}/${productId}`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n      } catch (err) {\r\n        console.error(\"Error removing item from backend cart:\", err);\r\n      }\r\n    }\r\n  };\r\n\r\n  const updateQuantity = async (productId, quantity) => {\r\n    setItems((prev) =>\r\n      prev.map((i) => (i.id === productId ? { ...i, quantity } : i))\r\n    );\r\n\r\n    // Sync with backend if user is logged in\r\n    if (user && token) {\r\n      try {\r\n        await axios.put(\r\n          `${API_BASE_URL}${ENDPOINTS.CART}/${productId}`,\r\n          { quantity },\r\n          { headers: { Authorization: `Bearer ${token}` } }\r\n        );\r\n      } catch (err) {\r\n        console.error(\"Error updating cart quantity in backend:\", err);\r\n      }\r\n    }\r\n  };\r\n\r\n  const clearCart = async () => {\r\n    setItems([]);\r\n\r\n    // Sync with backend if user is logged in\r\n    if (user && token) {\r\n      try {\r\n        await axios.delete(`${API_BASE_URL}${ENDPOINTS.CART}`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n      } catch (err) {\r\n        console.error(\"Error clearing backend cart:\", err);\r\n      }\r\n    }\r\n  };\r\n\r\n  const getTotalPrice = () => {\r\n    return items.reduce(\r\n      (sum, i) => sum + Number(i.price || 0) * Number(i.quantity || 1),\r\n      0\r\n    );\r\n  };\r\n\r\n  const getTotalItems = () =>\r\n    items.reduce((sum, i) => sum + Number(i.quantity || 0), 0);\r\n\r\n  return (\r\n    <CartContext.Provider\r\n      value={{\r\n        items,\r\n        addToCart,\r\n        removeFromCart,\r\n        updateQuantity,\r\n        clearCart,\r\n        getTotalPrice,\r\n        getTotalItems,\r\n        loading,\r\n      }}\r\n    >\r\n      {children}\r\n    </CartContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useCart = () => {\r\n  const ctx = useContext(CartContext);\r\n  if (!ctx) throw new Error(\"useCart must be used within CartProvider\");\r\n  return ctx;\r\n};\r\n\r\nexport default CartContext;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}